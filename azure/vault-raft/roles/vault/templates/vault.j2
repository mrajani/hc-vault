storage "raft" {
  path = "/opt/vault/raft"
  node_id = "{{ ansible_hostname }}"

  retry_join {
    auto_join = "provider=azure tag_name=vault_consul_member tag_value=join subscription_id={{ subscription_id }}  resource_group={{ resource_group }} vm_scale_set={{ vm_scale_set }}"
    auto_join_scheme        = "https"
    leader_tls_servername   = "127.0.0.1"
    leader_ca_cert_file     = "/etc/vault.d/ca.crt.pem"
    leader_client_cert_file = "/etc/vault.d/vault.crt.pem"
    leader_client_key_file  = "/etc/vault.d/vault.key.pem"
  }
}

api_addr          = "https://{{ ansible_default_ipv4.address }}:8200"
cluster_addr      = "https://{{ ansible_default_ipv4.address }}:8201"

listener "tcp" {
  address             = "[::]:8200"
  cluster_address     = "[::]:8201"
  tls_cert_file       = "/etc/vault.d/vault.crt.pem"
  tls_key_file        = "/etc/vault.d/vault.key.pem"
  tls_client_ca_file  = "/etc/vault.d/ca.crt.pem"
  tls_min_version     = "tls12"
  tls_disable         = false
}

#seal "azurekeyvault" {
# tenant_id       = "246dd7ab-f96c-4efb-<last_part_hidden"
# vault_name      = "vault-k8s-data"
# key_name        = "vault-k8s-unsealer-key"
# client_id       = "defdac63-6f29-4670-<last_part_hidden"
# client_secret   = "3qT0C1YfnHa_9~kqQf.<last_part_hidden"
# subscription_id = {{ subscription_id }}
#}

ui                = true
default_lease_ttl = "24h"
max_lease_ttl     = "24h"
cluster_name      = "Iono-Vault-Raft-On-Azure"
